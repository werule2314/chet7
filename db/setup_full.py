import sys
import os
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from db.models import Term, Definition, Source, get_engine, Base
from sqlalchemy.orm import sessionmaker
from utils.security import encrypt_text
from dotenv import load_dotenv
import random

load_dotenv()

# --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–ê–ó–´ ---
print("üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")

engine = get_engine()
Session = sessionmaker(bind=engine)
session = Session()

Base.metadata.drop_all(engine)
Base.metadata.create_all(engine)

print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞.")

# --- –ù–ê–ü–û–õ–ù–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò ---
print("üì• –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤...")

sources = [
    Source(title="–ì–û–°–¢ 1234-56", year=2019),
    Source(title="–°–ª–æ–≤–∞—Ä—å –ø–æ –ò–ë", year=2020),
    Source(title="–ú–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –§–°–¢–≠–ö", year=2021),
    Source(title="ISO/IEC 27001", year=2018),
    Source(title="–£—á–µ–±–Ω–∏–∫ –ø–æ –ò–ë, –¢–æ–º I", year=2022)
]

terms_data = {
    "–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å": [
        "–°–≤–æ–π—Å—Ç–≤–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ–π —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º —Å—É–±—ä–µ–∫—Ç–∞–º.",
        "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–º –ª–∏—Ü–∞–º."
    ],
    "–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è": [
        "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–æ–ª—è –∏–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞."
    ],
    "–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å": [
        "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.",
        "–ó–∞—â–∏—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π."
    ],
    "–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å": [
        "–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è."
    ],
    "–ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø": [
        "–î–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º –±–µ–∑ –ø—Ä–∞–≤ –∏–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è."
    ],
    "–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è": [
        "–ù–∞—É–∫–∞ –æ –º–µ—Ç–æ–¥–∞—Ö –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è."
    ],
    "–°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ": [
        "–ú–µ—Ç–æ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–ª—é—á –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏."
    ],
    "–ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ": [
        "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—ã –∫–ª—é—á–µ–π: –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∏ –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏."
    ],
    "–¶–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å": [
        "–ú–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞."
    ],
    "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å": [
        "–°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞—â–∏—â—ë–Ω–Ω–æ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã –æ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∏ –≤–Ω–µ—à–Ω–∏—Ö —É–≥—Ä–æ–∑."
    ]
}

for term_name, definitions in terms_data.items():
    term = Term(name=term_name)
    for definition in definitions:
        encrypted = encrypt_text(definition)
        term.definitions.append(Definition(content=encrypted))
    term.sources.extend(random.sample(sources, k=random.randint(1, 3)))
    session.add(term)

session.add_all(sources)
session.commit()
session.close()

print("üéâ –ë–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞. –í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É!")
